<!DOCTYPE html>
<html>
    <head>
        <title>Text Detector</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"
            integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    </head>
    <body>
        <main>
            <div class="container mt-5">
                <div class="row">
                    <div class="col-12">
                        <div class = "progress progress-bar progress-bar-striped progress-bar-animated mb-2">Loading Model</div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6">
                        <input id="image-selector" class="form-control border-0" type="file", multiple="multiple">
                    </div>
                    <div class="col-6">
                        <button id="predict-button" class="btn btn-dark float-end">Predict</button>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col">
                        <h2 class="ml-3">Predictions</h2>
                        <ol id="prediction-list"></ol>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-12">
                        <h2 class="ml-3">Image</h2>
                        <img id="selected-image" class="ml-3" src="" />
                    </div>
                </div>
            </div>
        </main>
    </body>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js">

    </script>
    <script>
        // localStorage.setItem("model", "./models/cat_dogs_model/")

        async function loadModel() {
            console.log("model loading..");
            
            // clear the model variable
            let model = undefined;

            reader = new FileReader('./models/cat_dogs_model/model.json')

            model = await tf.loadLayersModel(reader);
  
            $(".progress-bar").hide();
        }

        loadModel();

        // JavaScript
        // webcamElement
        $("#image-selector").change(function () {
            let reader = new FileReader();
            reader.onload = function () {
                let dataURL = reader.result;
                $("#selected-image").attr("src", dataURL);
                $("#prediction-list").empty();
            }
            let file = $("#image-selector").prop("files")[0];
            reader.readAsDataURL(file);
        });
    
        $("#predict-button").click(async function(){
            console.log("on click button");
            let image = $("#selected-image").get(0);
            let tensor = tf.browser.fromPixels(image);
            tensor = tf.cast(tensor, 'float32');
            console.log(tensor.shape);
            const preds = await model.predict(tensor);
        });
    </script>
</html>

